<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MaaK Content Generator | EN/MM</title>
    <meta name="theme-color" content="#4f46e5"/>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Padauk:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .font-myanmar {
            font-family: 'Padauk', sans-serif;
        }
        .custom-loader {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: 
                radial-gradient(farthest-side,#4f46e5 94%,#0000) top/8px 8px no-repeat,
                conic-gradient(#0000 30%,#4f46e5);
            -webkit-mask: radial-gradient(farthest-side,#0000 calc(100% - 8px),#000 0);
            animation:c3 1s infinite linear;
        }
        @keyframes c3 { 
            100% {transform: rotate(1turn)}
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .modal-backdrop {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.5); z-index: 40; opacity: 0; transition: opacity 0.3s ease-in-out;
        }
        .modal-backdrop.show { display: block; opacity: 1; }
        .modal {
            display: none; position: fixed; top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0.95); z-index: 50;
            opacity: 0; transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        .modal.show { display: block; opacity: 1; transform: translate(-50%, -50%) scale(1); }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 antialiased">

    <div class="container mx-auto px-4 py-8 md:py-12">
        <main class="max-w-7xl mx-auto">
            
            <header class="text-center mb-8">
                <h1 class="text-3xl md:text-4xl font-bold text-indigo-600">MaaK Content Generator</h1>
                <p class="text-slate-500 mt-2 font-myanmar text-lg">အကြောင်းအရာ ဖန်တီးမှု လက်ထောက်</p>
            </header>

            <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">

                <!-- Input Form Section -->
                <div class="lg:col-span-2 bg-white p-6 rounded-2xl shadow-lg self-start">
                    <form id="contentForm">
                        <h2 class="text-2xl font-semibold mb-6 border-b pb-3 flex items-center">
                            <i data-lucide="sliders-horizontal" class="mr-3 text-indigo-500"></i>
                            <span data-i18n-key="formTitle">Controls</span>
                        </h2>
                        
                        <div class="space-y-5">
                             <div>
                                <label for="language" class="block text-sm font-medium text-slate-700 mb-1" data-i18n-key="languageLabel">Language</label>
                                <select id="language" name="language" class="w-full bg-slate-50 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block p-2.5 transition">
                                    <option value="English">English</option>
                                    <option value="Burmese (Myanmar)">Myanmar (Burmese)</option>
                                </select>
                            </div>
                            <div>
                                <label for="contentType" class="block text-sm font-medium text-slate-700 mb-1" data-i18n-key="contentTypeLabel">Content Type</label>
                                <select id="contentType" name="contentType" class="w-full bg-slate-50 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block p-2.5 transition"></select>
                            </div>
                             <div>
                                <label for="tone" class="block text-sm font-medium text-slate-700 mb-1" data-i18n-key="toneLabel">Tone</label>
                                <select id="tone" name="tone" class="w-full bg-slate-50 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block p-2.5 transition"></select>
                            </div>
                            <div>
                                <label for="maxLength" class="block text-sm font-medium text-slate-700 mb-1" data-i18n-key="maxLengthLabel">Max Length (Words)</label>
                                <input type="number" id="maxLength" name="maxLength" class="w-full bg-slate-50 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block p-2.5 transition" placeholder="e.g., 300">
                            </div>
                            <div>
                                <label for="title" class="block text-sm font-medium text-slate-700 mb-1" data-i18n-key="titleLabel">Title</label>
                                <input type="text" id="title" name="title" class="w-full bg-slate-50 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block p-2.5 transition">
                            </div>
                            <div>
                                <label for="subject" class="block text-sm font-medium text-slate-700 mb-1" data-i18n-key="subjectLabel">Subject / Topic</label>
                                <input type="text" id="subject" name="subject" class="w-full bg-slate-50 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block p-2.5 transition">
                            </div>
                            <div>
                                <label for="description" class="block text-sm font-medium text-slate-700 mb-1" data-i18n-key="descriptionLabel">Description / Prompt</label>
                                <textarea id="description" name="description" rows="5" class="w-full bg-slate-50 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block p-2.5 transition"></textarea>
                            </div>
                            <button type="submit" id="generateBtn" class="w-full text-white bg-indigo-600 hover:bg-indigo-700 focus:ring-4 focus:outline-none focus:ring-indigo-300 font-medium rounded-lg text-sm px-5 py-3 text-center transition duration-300 ease-in-out flex items-center justify-center">
                                <i data-lucide="sparkles" class="mr-2 h-5 w-5"></i>
                                <span id="generateBtnText" data-i18n-key="generateBtnText">Generate Content</span>
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Output Section -->
                <div class="lg:col-span-3">
                    <div id="outputContainer" class="bg-white p-6 rounded-2xl shadow-lg min-h-[500px] flex flex-col">
                         <div class="flex justify-between items-center border-b pb-3 mb-4">
                            <h2 class="text-2xl font-semibold flex items-center"><i data-lucide="file-text" class="mr-3 text-indigo-500"></i><span data-i18n-key="outputTitle">Generated Content</span></h2>
                            <div id="outputActions" class="hidden items-center space-x-2">
                                <button id="saveBtn" title="Save Content" class="text-slate-400 hover:text-indigo-600 transition duration-300 p-2 rounded-md">
                                    <i data-lucide="save" class="h-5 w-5"></i>
                                </button>
                                <button id="copyBtn" title="Copy to clipboard" class="text-slate-400 hover:text-indigo-600 transition duration-300 p-2 rounded-md">
                                    <i data-lucide="copy" class="h-5 w-5"></i>
                                </button>
                            </div>
                        </div>
                        <div id="output" class="prose max-w-none text-slate-600 flex-grow overflow-y-auto pr-2">
                           <div id="placeholder" class="h-full flex flex-col items-center justify-center text-center text-slate-400">
                               <i data-lucide="wand-2" class="h-16 w-16 mb-4 text-slate-300"></i>
                               <p class="font-medium" data-i18n-key="placeholderMain">Your generated content will appear here.</p>
                               <p class="text-sm font-myanmar" data-i18n-key="placeholderSub">သင်၏ ဖန်တီးထားသော အကြောင်းအရာသည် ဤနေရာတွင် ပေါ်လာပါမည်။</p>
                           </div>
                           <div id="loader" class="hidden h-full flex items-center justify-center">
                                <div class="custom-loader"></div>
                           </div>
                           <div id="generatedText" class="whitespace-pre-wrap"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- History Section -->
            <div class="mt-8 bg-white p-6 rounded-2xl shadow-lg">
                <h2 class="text-2xl font-semibold mb-4 border-b pb-3 flex items-center">
                    <i data-lucide="history" class="mr-3 text-indigo-500"></i>
                    <span data-i18n-key="historyTitle">History</span>
                </h2>
                <div id="historyContainer" class="space-y-3 max-h-96 overflow-y-auto pr-2">
                    <p id="historyPlaceholder" class="text-slate-400 text-center py-8" data-i18n-key="historyPlaceholder">No saved content yet.</p>
                </div>
            </div>
             <!-- Advice Section -->
            <div class="mt-8 bg-indigo-50 border-2 border-indigo-200 border-dashed rounded-2xl p-6">
                <details>
                    <summary class="font-semibold text-indigo-800 cursor-pointer flex items-center justify-between">
                        <span class="flex items-center"><i data-lucide="lightbulb" class="inline-block mr-2 h-5 w-5"></i><span data-i18n-key="adviceTitle">Advice for Better Results</span></span>
                        <i data-lucide="chevron-down" class="h-5 w-5 transition-transform transform"></i>
                    </summary>
                    <div class="mt-4 text-sm text-indigo-700 space-y-3">
                        <p data-i18n-key="advice1" class="advice-content"></p>
                        <p data-i18n-key="advice2" class="advice-content"></p>
                        <p data-i18n-key="advice3" class="advice-content"></p>
                        <p data-i18n-key="advice4" class="advice-content"></p>
                    </div>
                </details>
            </div>
        </main>
        
        <!-- Modal for viewing history item -->
        <div id="viewModalBackdrop" class="modal-backdrop"></div>
        <div id="viewModal" class="modal w-11/12 md:w-2/3 lg:w-1/2 bg-white rounded-2xl shadow-2xl">
            <div class="p-6">
                <div class="flex justify-between items-center border-b pb-3 mb-4">
                    <h3 id="viewModalTitle" class="text-xl font-bold text-slate-800"></h3>
                    <button id="closeViewModalBtn" class="p-1 rounded-full hover:bg-slate-200 transition">
                        <i data-lucide="x" class="h-6 w-6 text-slate-500"></i>
                    </button>
                </div>
                <div id="viewModalContent" class="max-h-[60vh] overflow-y-auto prose max-w-none text-slate-600 whitespace-pre-wrap pr-2"></div>
            </div>
        </div>

        <!-- Custom Message/Alert Box -->
        <div id="messageBox" class="fixed top-5 right-5 bg-green-500 text-white px-6 py-3 rounded-lg shadow-xl transition-transform transform translate-x-[120%] z-50">
            <p id="messageText"></p>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const contentForm = document.getElementById('contentForm');
        const generateBtn = document.getElementById('generateBtn');
        const outputActions = document.getElementById('outputActions');
        const saveBtn = document.getElementById('saveBtn');
        const copyBtn = document.getElementById('copyBtn');
        const generatedText = document.getElementById('generatedText');
        const languageSelector = document.getElementById('language');
        const historyContainer = document.getElementById('historyContainer');
        const historyPlaceholder = document.getElementById('historyPlaceholder');
        const viewModal = document.getElementById('viewModal');
        const viewModalBackdrop = document.getElementById('viewModalBackdrop');
        const viewModalTitle = document.getElementById('viewModalTitle');
        const viewModalContent = document.getElementById('viewModalContent');
        const closeViewModalBtn = document.getElementById('closeViewModalBtn');
        const placeholder = document.getElementById('placeholder');
        const loader = document.getElementById('loader');
        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');
        
        // --- I18N Translations & Setup ---
        const translations = {
            "English": {
                "formTitle": "Controls", "languageLabel": "Language", "contentTypeLabel": "Content Type", "toneLabel": "Tone",
                "maxLengthLabel": "Max Length (Words)", "titleLabel": "Title", "subjectLabel": "Subject / Topic", "descriptionLabel": "Description / Prompt",
                "generateBtnText": "Generate Content", "generatingBtnText": "Generating...", "outputTitle": "Generated Content",
                "historyTitle": "History", "historyPlaceholder": "No saved content yet. Generate and save something!",
                "titlePlaceholder": "e.g., The Future of Renewable Energy", "subjectPlaceholder": "e.g., Solar Power, Wind Turbines",
                "descriptionPlaceholder": "Provide details: points to cover, tone, audience...",
                "placeholderMain": "Your generated content will appear here.", "placeholderSub": "",
                "adviceTitle": "Advice for Better Results",
                "advice1": "<strong>Be Specific:</strong> The more detailed your prompt, the better the output. Instead of \"write about business,\" try \"write a blog post for new entrepreneurs on the top 3 marketing strategies.\"",
                "advice2": "<strong>Define Audience & Tone:</strong> Who are you writing for? Example: \"Write in a friendly, encouraging tone for an audience of college students.\"",
                "advice3": "<strong>Provide Context:</strong> Give the AI a role. Example: \"Act as a seasoned travel writer and describe the beauty of Bagan's temples at sunrise.\"",
                "advice4": "<strong>Use Keywords:</strong> Include important keywords you want in the text to improve relevance and SEO.",
                "contentTypes": ["Blog Post", "Email", "Social Media Post", "Advertisement", "Video Script", "Product Description"],
                "tones": ["Formal", "Casual", "Professional", "Friendly", "Humorous", "Inspirational"],
                "copySuccess": "Content copied to clipboard!", "copyError": "Failed to copy content.",
                "saveSuccess": "Content saved successfully!", "saveError": "Failed to save content.",
                "deleteSuccess": "Content deleted!", "deleteError": "Failed to delete content.",
                "fillFields": "Please fill in the Subject and Description fields."
            },
            "Burmese (Myanmar)": {
                "formTitle": "ထိန်းချုပ်မှုများ", "languageLabel": "ဘာသာစကား", "contentTypeLabel": "အကြောင်းအရာ အမျိုးအစား", "toneLabel": "လေသံ",
                "maxLengthLabel": "အများဆုံး စကားလုံး (လုံးရေ)", "titleLabel": "ခေါင်းစဉ်", "subjectLabel": "ဘာသာရပ်", "descriptionLabel": "အသေးစိတ်ဖော်ပြချက်",
                "generateBtnText": "အကြောင်းအရာ ဖန်တီးပါ", "generatingBtnText": "ဖန်တီးနေသည်...", "outputTitle": "ဖန်တီးထားသော အကြောင်းအရာ",
                "historyTitle": "မှတ်တမ်း", "historyPlaceholder": "သိမ်းဆည်းထားသော အကြောင်းအရာ မရှိသေးပါ။",
                "titlePlaceholder": "ဥပမာ၊ ပြန်လည်ပြည့်ဖြိုးမြဲစွမ်းအင်၏ အနာဂတ်", "subjectPlaceholder": "ဥပမာ၊ ဆိုလာစွမ်းအင်၊ လေတာဘိုင်များ",
                "descriptionPlaceholder": "အသေးစိတ်များ- ထည့်သွင်းရမည့်အချက်များ၊ လေသံ၊ ပရိသတ်...",
                "placeholderMain": "သင်၏ ဖန်တီးထားသော အကြောင်းအရာသည် ဤနေရာတွင် ပေါ်လာပါမည်။", "placeholderSub": "",
                "adviceTitle": "ပိုမိုကောင်းမွန်သောရလဒ်များအတွက် အကြံပြုချက်",
                "advice1": "<strong>တိကျပါစေ-</strong> သင်၏တောင်းဆိုချက်သည် အသေးစိတ်ကျလေ၊ ရလဒ်ကောင်းလေဖြစ်သည်။ \"စီးပွားရေးအကြောင်းရေးပါ\" အစား \"စီးပွားရေးလုပ်ငန်းငယ်များအတွက် ထိပ်တန်းစျေးကွက်ရှာဖွေရေးဗျူဟာ ၃ ခုအကြောင်း ဘလော့ဂ်ပို့စ်တစ်ခုရေးပါ\" ဟုကြိုးစားပါ။",
                "advice2": "<strong>ပရိသတ်နှင့် လေသံကို သတ်မှတ်ပါ-</strong> သင်သည် မည်သူ့အတွက် ရေးနေသနည်း။ ဥပမာ- \"ကောလိပ်ကျောင်းသားများအတွက် ဖော်ရွေပြီး အားပေးသည့်လေသံဖြင့် ရေးသားပါ။\"",
                "advice3": "<strong>ဆက်စပ်အကြောင်းအရာကို ပေးပါ-</strong> AI အား အခန်းကဏ္ဍတစ်ခုပေးပါ။ ဥပမာ- \"အတွေ့အကြုံရင့်ခရီးသွားစာရေးဆရာတစ်ဦးအဖြစ် ဆောင်ရွက်ပြီး နေထွက်ချိန်တွင် ပုဂံဘုရားပုထိုးများ၏ အလှကို ဖော်ပြပါ။\"",
                "advice4": "<strong>သော့ချက်စကားလုံးများသုံးပါ-</strong> ဆက်စပ်မှုနှင့် SEO ပိုမိုကောင်းမွန်စေရန် သင်ထည့်သွင်းလိုသော အရေးကြီးသောသော့ချက်စကားလုံးများကို ထည့်သွင်းပါ။",
                "contentTypes": ["ဘလော့ဂ်ပို့စ်", "အီးမေးလ်", "ဆိုရှယ်မီဒီယာ ပို့စ်", "ကြော်ငြာ", "ဗီဒီယိုဇာတ်ညွှန်း", "ကုန်ပစ္စည်း ဖော်ပြချက်"],
                "tones": ["တရားဝင်", "ပေါ့ပေါ့ပါးပါး", "ကျွမ်းကျင်ပိုင်နိုင်သော", "ဖော်ရွေသော", "ဟာသဉာဏ်ရွှင်သော", "စိတ်အားထက်သန်စေသော"],
                "copySuccess": "Clipboard သို့ ကူးယူပြီးပါပြီ!", "copyError": "ကူးယူရန် မအောင်မြင်ပါ။",
                "saveSuccess": "အကြောင်းအရာကို အောင်မြင်စွာ သိမ်းဆည်းပြီးပါပြီ!", "saveError": "သိမ်းဆည်းရန် မအောင်မြင်ပါ။",
                "deleteSuccess": "အကြောင်းအရာကို ဖျက်လိုက်ပါပြီ!", "deleteError": "ဖျက်ရန် မအောင်မြင်ပါ။",
                "fillFields": "ကျေးဇူးပြု၍ ဘာသာရပ်နှင့် အသေးစိတ်ဖော်ပြချက်ကို ဖြည့်စွက်ပါ။"
            }
        };

        function setLanguage(lang) {
            const t = translations[lang];
            document.querySelectorAll('[data-i18n-key]').forEach(el => {
                const key = el.dataset.i18nKey;
                if (t[key]) {
                    if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') el.placeholder = t[key];
                    else if(el.classList.contains('advice-content')) el.innerHTML = t[key];
                    else el.textContent = t[key];
                }
            });
            const contentTypeSelect = document.getElementById('contentType');
            const toneSelect = document.getElementById('tone');
            contentTypeSelect.innerHTML = t.contentTypes.map(o => `<option>${o}</option>`).join('');
            toneSelect.innerHTML = t.tones.map(o => `<option>${o}</option>`).join('');
            const elementsToStyle = document.querySelectorAll('[data-i18n-key], .advice-content');
            elementsToStyle.forEach(el => {
                if (lang === 'Burmese (Myanmar)') el.classList.add('font-myanmar');
                else el.classList.remove('font-myanmar');
            });
        }

        // --- Local Storage History ---
        function getHistory() {
            return JSON.parse(localStorage.getItem('contentHistory') || '[]');
        }

        function saveHistory(history) {
            localStorage.setItem('contentHistory', JSON.stringify(history));
        }
        
        function renderHistory() {
            const history = getHistory().sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            historyContainer.innerHTML = '';
            if (history.length === 0) {
                historyPlaceholder.style.display = 'block';
                return;
            }
            historyPlaceholder.style.display = 'none';
            history.forEach(item => renderHistoryItem(item));
        }

        // --- UI Functions ---
        function showMessage(message, isError = false) {
            messageText.textContent = message;
            messageBox.classList.remove('bg-green-500', 'bg-red-500', 'translate-x-[120%]');
            messageBox.classList.add(isError ? 'bg-red-500' : 'bg-green-500', 'translate-x-0');
            setTimeout(() => { messageBox.classList.add('translate-x-[120%]'); }, 3000);
        }

        function renderHistoryItem(data) {
            const item = document.createElement('div');
            item.className = 'p-3 bg-slate-50 rounded-lg flex justify-between items-center border hover:bg-slate-100 transition';
            const langClass = data.language.includes('Burmese') ? 'font-myanmar' : '';

            item.innerHTML = `
                <div class="flex-grow cursor-pointer" data-id="${data.id}">
                    <p class="font-semibold text-slate-800 ${langClass}">${data.title || 'Untitled'}</p>
                    <p class="text-xs text-slate-500">${new Date(data.createdAt).toLocaleString()}</p>
                </div>
                <div class="flex items-center space-x-1">
                    <button class="view-btn p-2 rounded-md hover:bg-slate-200" title="View"><i data-lucide="eye" class="h-4 w-4 text-slate-600"></i></button>
                    <button class="delete-btn p-2 rounded-md hover:bg-red-100" title="Delete"><i data-lucide="trash-2" class="h-4 w-4 text-red-500"></i></button>
                </div>
            `;
            item.querySelector('.flex-grow').addEventListener('click', () => showViewModal(data));
            item.querySelector('.view-btn').addEventListener('click', () => showViewModal(data));
            item.querySelector('.delete-btn').addEventListener('click', () => {
                 let history = getHistory();
                 history = history.filter(h => h.id !== data.id);
                 saveHistory(history);
                 renderHistory();
                 showMessage(translations[languageSelector.value].deleteSuccess);
            });
            historyContainer.appendChild(item);
            lucide.createIcons();
        }

        function showViewModal(data) {
            viewModalTitle.textContent = data.title || 'Untitled';
            viewModalContent.textContent = data.content;
            viewModalTitle.classList.toggle('font-myanmar', data.language.includes('Burmese'));
            viewModalContent.classList.toggle('font-myanmar', data.language.includes('Burmese'));
            viewModal.classList.add('show');
            viewModalBackdrop.classList.add('show');
        }

        function hideViewModal() {
            viewModal.classList.remove('show');
            viewModalBackdrop.classList.remove('show');
        }

        // --- Event Listeners ---
        languageSelector.addEventListener('change', (e) => setLanguage(e.target.value));

        contentForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(contentForm);
            const data = Object.fromEntries(formData.entries());

            if (!data.subject || !data.description) {
                showMessage(translations[languageSelector.value].fillFields, true);
                return;
            }

            let prompt = `Act as an expert content creator. Generate a "${data.contentType}" in ${data.language}. The tone should be ${data.tone}.`;
            if (data.maxLength) prompt += ` The content should be approximately ${data.maxLength} words.`;
            prompt += ` The title is: "${data.title}". The main subject is: "${data.subject}".
            Here is a detailed description: "${data.description}".
            Ensure the output is well-structured, engaging, and directly addresses the prompt.
            The language of your response MUST be ${data.language}.`;

            placeholder.classList.add('hidden');
            loader.classList.remove('hidden');
            generatedText.textContent = '';
            outputActions.classList.add('hidden');
            generateBtn.disabled = true;

            const t = translations[languageSelector.value];
            generateBtn.innerHTML = `<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><span class="${languageSelector.value === 'Burmese (Myanmar)' ? 'font-myanmar' : ''}">${t.generatingBtnText}</span>`;
            
            try {
                const apiKey = "AIzaSyChYUdEU30E7mUpVlJ4cCfQU94nsX9EvFg";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                const payload = { contents: [{ parts: [{ text: prompt }] }] };
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error((await response.json()).error.message || `API Error: ${response.status}`);
                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                if (!text) throw new Error("No content generated.");
                
                generatedText.textContent = text;
                generatedText.dataset.fullContent = text;
                generatedText.dataset.title = data.title;
                generatedText.dataset.language = data.language;
                generatedText.classList.toggle('font-myanmar', data.language.includes('Burmese'));
                outputActions.classList.remove('hidden');
                outputActions.classList.add('flex');
            } catch (error) {
                console.error('Error:', error);
                generatedText.textContent = `An error occurred: ${error.message}`;
                showMessage(error.message, true);
            } finally {
                loader.classList.add('hidden');
                generateBtn.disabled = false;
                generateBtn.innerHTML = `<i data-lucide="sparkles" class="mr-2 h-5 w-5"></i><span id="generateBtnText" data-i18n-key="generateBtnText">${t.generateBtnText}</span>`;
                lucide.createIcons();
            }
        });

        copyBtn.addEventListener('click', () => {
            const textToCopy = generatedText.dataset.fullContent;
            navigator.clipboard.writeText(textToCopy).then(() => {
                showMessage(translations[languageSelector.value].copySuccess);
            }, () => {
                showMessage(translations[languageSelector.value].copyError, true);
            });
        });

        saveBtn.addEventListener('click', () => {
            const history = getHistory();
            const contentToSave = {
                id: Date.now().toString(),
                title: generatedText.dataset.title || 'Untitled',
                content: generatedText.dataset.fullContent,
                language: generatedText.dataset.language,
                createdAt: new Date().toISOString()
            };
            history.push(contentToSave);
            saveHistory(history);
            renderHistory();
            showMessage(translations[languageSelector.value].saveSuccess);
        });

        closeViewModalBtn.addEventListener('click', hideViewModal);
        viewModalBackdrop.addEventListener('click', hideViewModal);

        // --- Initial Load & PWA Registration ---
        document.addEventListener('DOMContentLoaded', () => {
            setLanguage(languageSelector.value);
            renderHistory();
            lucide.createIcons();
            
            const detailsElement = document.querySelector('details');
            detailsElement.addEventListener('toggle', () => {
                const summaryIcon = detailsElement.querySelector('summary .lucide-chevron-down');
                if (summaryIcon) {
                    summaryIcon.style.transform = detailsElement.open ? 'rotate(180deg)' : 'rotate(0deg)';
                }
            });
            
            // Register Service Worker
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('./sw.js').then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    }, err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
                });
            }
        });

    </script>
</body>
</html>

